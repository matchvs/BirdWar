{"version":3,"sources":["gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","onLoad","Game","GameManager","game","addPersistRootNode","node","director","getCollisionManager","enabled","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","on","eventType","roundOver","leaveRoomNotify","leaveRoom","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","wx","login","success","getUserInfo","fail","res","errMsg","indexOf","console","log","nickName","userInfo","avatarUrl","e","data","dispatch","leaveRoomNotifyMed","gameState","GameState","Play","leaveRoomInfo","owner","id","isRoomOwner","friends","friendIds","filter","x","userId","length","friendCnt","gameOver","loseCamp","Camp","Friend","setTimeout","uiFunc","openUI","obj","uiVsResult","getComponent","enemyIds","selfScore","enemyHearts","rivalScore","friendHearts","setData","bind","enemyCnt","Enemy","curRound","None","timeOver","Over","sendRoundStartMsg","startGame","readyCnt","loadScene","sendReadyMsg","sendRoundOverMsg","msg","action","ROUND_OVER","sendEventEx","ROUND_START","READY","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","result","engine","channel","platform","gameId","kickPlayerRsp","status","rsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","removePersistRootNode","error","uiTip","logout","registerUser","deviceId","gatewayId","token","gameVersion","appKey","secret","info","lobbyShow","Canvas","instance","designResolution","height","width","cpProto","JSON","parse","GAME_START_EVENT","playerUserIds","remoteUserIds","userIds","selfCamp","index","camp","push","concat","player","PLAYER_FLY_EVENT","PlayerManager","getPlayerByUserId","srcUserId","flyNotify","PLAYER_FIRE_EVENT","i","j","playerId","fireNotify","bulletPointY","NEW_ITEM_EVENT","ItemManager","spawnItemNotify","PLAYER_GET_ITEM_EVENT","getItemNotify","PLAYER_REMOVE_ITEM_EVENT","removeItemNotify","PLAYER_HURT_EVENT","hurtNotify","murderId","getLoseCamp","loseCamp1","roundStart","TIME_OVER","m","dead","stringify","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","send","userInfoReq","onDestroy","off"],"mappings":"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","file":"gameManager.js","sourceRoot":"../../../../../../assets/common/script/basic","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n    onLoad() {\n        Game.GameManager = this;\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getCollisionManager().enabled = true;\n        clientEvent.init();\n        dataFunc.loadConfigs();\n        cc.view.enableAutoFullScreen(false);\n        clientEvent.on(clientEvent.eventType.roundOver, this.roundOver, this);\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        this.network = window.network;\n        network.chooseNetworkMode();\n        this.getRankDataListener();\n        this.findPlayerByAccountListener();\n        try {\n            wx.login({\n                success: function() {\n                    wx.getUserInfo({\n                        fail: function(res) {\n                            // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                            if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                                // 处理用户拒绝授权的情况\n                                console.log(\"fail\");\n                            }\n                        },\n                        success: function(res) {\n                            Game.GameManager.nickName = res.userInfo.nickName;\n                            Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\n                            console.log('success', Game.GameManager.nickName);\n                        }\n                    });\n                }\n            })\n        } catch (e) {\n            \n        }\n    },\n\n    leaveRoom: function(data) {\n        // 离开房间--\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotifyMed, data);\n        console.log(\"离开房间\");\n        if (this.gameState === GameState.Play) {\n            if (data.leaveRoomInfo.owner === GLB.userInfo.id) {\n                GLB.isRoomOwner = true;\n            }\n            var friends = this.friendIds.filter(function(x) {\n                return x === data.leaveRoomInfo.userId;\n            });\n\n            if (friends.length > 0) {\n                this.friendCnt--;\n                if (this.friendCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Friend});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            } else {\n                this.enemyCnt--;\n                if (this.enemyCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Enemy});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            }\n        }\n    },\n\n    roundOver: function(data) {\n        this.curRound++;\n        switch (data.loseCamp) {\n            case Camp.Friend:\n                this.friendHearts -= 1;\n                break;\n            case Camp.Enemy:\n                this.enemyHearts -= 1;\n                break;\n            case Camp.None:\n                this.enemyHearts -= 1;\n                this.friendHearts -= 1;\n                break;\n        }\n\n        if (this.enemyHearts > 0 && this.friendHearts > 0 && data.loseCamp === Camp.None) {\n            clientEvent.dispatch(clientEvent.eventType.timeOver);\n        }\n\n        if (this.enemyHearts <= 0 || this.friendHearts <= 0) {\n            // 结算界面--\n            this.gameState = GameState.Over;\n            var loseCamp = Camp.None;\n            if (this.enemyHearts <= 0 && this.friendHearts <= 0) {\n                loseCamp = Camp.None;\n            } else if (this.enemyHearts <= 0) {\n                loseCamp = Camp.Enemy;\n            } else {\n                loseCamp = Camp.Friend;\n            }\n            clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: loseCamp});\n            setTimeout(function() {\n                uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                    var uiVsResult = obj.getComponent(\"uiVsResult\");\n                    data = {\n                        friendIds: this.friendIds,\n                        enemyIds: this.enemyIds,\n                        selfScore: 3 - this.enemyHearts,\n                        rivalScore: 3 - this.friendHearts\n                    }\n                    uiVsResult.setData(data);\n                }.bind(this))\n            }.bind(this), 1500);\n\n        } else if (GLB.isRoomOwner) {\n            // 下一回合--\n            setTimeout(function() {\n                this.sendRoundStartMsg();\n            }.bind(this), 3000);\n        }\n    },\n\n    startGame: function() {\n        this.friendHearts = 3;\n        this.enemyHearts = 3;\n        this.curRound = 1;\n        this.readyCnt = 0;\n        this.friendCnt = this.friendIds.length;\n        this.enemyCnt = this.enemyIds.length;\n\n        cc.director.loadScene('game', function() {\n            uiFunc.openUI(\"uiGamePanel\", function() {\n                this.sendReadyMsg();\n            }.bind(this));\n        }.bind(this));\n    },\n\n    sendRoundOverMsg: function(loseCamp) {\n        var msg = {action: GLB.ROUND_OVER, loseCamp: loseCamp};\n        this.sendEventEx(msg);\n    },\n\n    sendRoundStartMsg: function() {\n        var msg = {action: GLB.ROUND_START};\n        this.sendEventEx(msg);\n    },\n\n    sendReadyMsg: function() {\n        var msg = {action: GLB.READY};\n        this.sendEventEx(msg);\n    },\n\n    matchVsInit: function() {\n        mvs.response.initResponse = this.initResponse.bind(this);\n        mvs.response.errorResponse = this.errorResponse.bind(this);\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\n\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\n        if (result !== 0) {\n            console.log('初始化失败,错误码:' + result);\n        }\n    },\n\n    kickPlayerNotify: function(kickPlayerNotify) {\n        var data = {\n            kickPlayerNotify: kickPlayerNotify\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\n    },\n\n    kickPlayerResponse: function(kickPlayerRsp) {\n        if (kickPlayerRsp.status !== 200) {\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\n            return;\n        }\n        var data = {\n            kickPlayerRsp: kickPlayerRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\n    },\n\n    getRoomListExResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\n    },\n\n    getRoomDetailResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\n    },\n\n    getRoomListResponse: function(status, roomInfos) {\n        if (status !== 200) {\n            console.log(\"失败 status:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomInfos: roomInfos\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\n    },\n\n    createRoomResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 createRoomResponse:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\n    },\n\n    joinOverResponse: function(joinOverRsp) {\n        if (joinOverRsp.status !== 200) {\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\n            return;\n        }\n        var data = {\n            joinOverRsp: joinOverRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\n    },\n\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\n        if (status !== 200) {\n            console.log(\"失败 joinRoomResponse:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomUserInfoList: roomUserInfoList,\n            roomInfo: roomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\n    },\n\n    joinRoomNotify: function(roomUserInfo) {\n        var data = {\n            roomUserInfo: roomUserInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\n    },\n\n    leaveRoomResponse: function(leaveRoomRsp) {\n        if (leaveRoomRsp.status !== 200) {\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\n            return;\n        }\n        var data = {\n            leaveRoomRsp: leaveRoomRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\n    },\n\n    leaveRoomNotify: function(leaveRoomInfo) {\n        var data = {\n            leaveRoomInfo: leaveRoomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\n    },\n\n    logoutResponse: function(status) {\n        cc.game.removePersistRootNode(this.node);\n        cc.director.loadScene('lobby');\n    },\n\n    errorResponse: function(error, msg) {\n        if (error === 1001) {\n            uiFunc.openUI(\"uiTip\", function(obj) {\n                var uiTip = obj.getComponent(\"uiTip\");\n                if (uiTip) {\n                    uiTip.setData(\"网络断开连接\");\n                }\n            });\n            setTimeout(function() {\n                mvs.engine.logout(\"\");\n                cc.game.removePersistRootNode(this.node);\n                cc.director.loadScene('lobby');\n            }.bind(this), 2500);\n        }\n        console.log(\"错误信息：\" + error);\n        console.log(\"错误信息：\" + msg);\n    },\n\n    initResponse: function() {\n        console.log('初始化成功，开始注册用户');\n        var result = mvs.engine.registerUser();\n        if (result !== 0) {\n            console.log('注册用户失败，错误码:' + result);\n        } else {\n            console.log('注册用户成功');\n        }\n    },\n\n    registerUserResponse: function(userInfo) {\n        var deviceId = 'abcdef';\n        var gatewayId = 0;\n        GLB.userInfo = userInfo;\n\n        console.log('开始登录,用户Id:' + userInfo.id)\n\n        var result = mvs.engine.login(\n            userInfo.id, userInfo.token,\n            GLB.gameId, GLB.gameVersion,\n            GLB.appKey, GLB.secret,\n            deviceId, gatewayId\n        );\n        if (result !== 0) {\n            console.log('登录失败,错误码:' + result);\n        }\n    },\n\n    loginResponse: function(info) {\n        if (info.status !== 200) {\n            console.log('登录失败,异步回调错误码:' + info.status);\n        } else {\n            console.log('登录成功');\n            this.lobbyShow();\n        }\n    },\n\n    lobbyShow: function() {\n        this.gameState = GameState.None;\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiLobbyPanelVer\");\n        } else {\n            uiFunc.openUI(\"uiLobbyPanel\");\n        }\n    },\n\n    // 玩家行为通知--\n    sendEventNotify: function(info) {\n        var cpProto = JSON.parse(info.cpProto);\n\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\n            GLB.playerUserIds = [GLB.userInfo.id]\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\n            // 分队--\n            if (remoteUserIds.length % 2 !== 0) {\n                return console.log(\"人数不为偶数, 无法开战！\");\n            }\n            var selfCamp = 0;\n            var index;\n            for (index = 0; index < remoteUserIds.length; index++) {\n                if (GLB.userInfo.id === remoteUserIds[index]) {\n                    if (index < remoteUserIds.length / 2) {\n                        selfCamp = 0;\n                    } else {\n                        selfCamp = 1;\n                    }\n                    break;\n                }\n            }\n            this.enemyIds = [];\n            this.friendIds = [GLB.userInfo.id];\n            for (index = 0; index < remoteUserIds.length; index++) {\n                var camp = 0;\n                if (index < remoteUserIds.length / 2) {\n                    camp = 0;\n                } else {\n                    camp = 1;\n                }\n                if (camp === selfCamp) {\n                    if (remoteUserIds[index] !== GLB.userInfo.id) {\n                        this.friendIds.push(remoteUserIds[index]);\n                    }\n                } else {\n                    this.enemyIds.push(remoteUserIds[index]);\n                }\n            }\n            GLB.playerUserIds = this.friendIds.concat(this.enemyIds);\n            console.log(\"remoteUserIds:\" + remoteUserIds);\n            console.log(\"GLB.playerUserIds:\" + GLB.playerUserIds);\n\n            this.startGame();\n        }\n\n        var player = null;\n        if (info.cpProto.indexOf(GLB.PLAYER_FLY_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.flyNotify();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_FIRE_EVENT) >= 0) {\n            for (var i = 0; i < GLB.playerUserIds.length; i++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[i]);\n                if (player) {\n                    for (var j = 0; j < cpProto.data.length; j++) {\n                        if (cpProto.data[j].playerId === player.userId) {\n                            player.fireNotify(cpProto.data[j].bulletPointY);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.NEW_ITEM_EVENT) >= 0) {\n            Game.ItemManager.spawnItemNotify(cpProto);\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_GET_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n            if (player) {\n                player.getItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_REMOVE_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.removeItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_HURT_EVENT) >= 0) {\n            if (Game.GameManager.gameState !== GameState.Over) {\n                player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n                if (player) {\n                    player.hurtNotify(cpProto.murderId);\n                }\n                // 检查回合结束--\n                var loseCamp = Game.PlayerManager.getLoseCamp();\n                if (loseCamp != null) {\n                    Game.GameManager.gameState = GameState.Over\n                    if (GLB.isRoomOwner) {\n                        this.sendRoundOverMsg(loseCamp);\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            // 如果发送方为敌方--\n            var loseCamp1 = cpProto.loseCamp;\n            if (this.friendIds.indexOf(info.srcUserId) < 0) {\n                if (loseCamp1 === Camp.Friend) {\n                    loseCamp1 = Camp.Enemy;\n                } else if (loseCamp1 === Camp.Enemy) {\n                    loseCamp1 = Camp.Friend;\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: loseCamp1});\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\n            Game.GameManager.gameState = GameState.Play;\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\n        }\n\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\n            this.readyCnt++;\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\n                this.sendRoundStartMsg();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.TIME_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            for (var m = 0; m < GLB.playerUserIds.length; m++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[m]);\n                if (player) {\n                    player.dead();\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: Camp.None});\n        }\n    },\n\n    sendEventEx: function(msg) {\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    },\n\n    getRankDataListener: function() {\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\n                uiRankPanel.setData(recvMsg.rankArray);\n            });\n        }.bind(this));\n    },\n\n    findPlayerByAccountListener: function() {\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\n        });\n    },\n\n    loginServer: function() {\n        if (!this.network.isConnected()) {\n            this.network.connect(GLB.IP, GLB.PORT, function() {\n                    this.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        this.network.send(\"connector.rankHandler.updateScore\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game0\"\n                        });\n                    }.bind(this), 500);\n\n                }.bind(this)\n            );\n        } else {\n            this.network.send(\"connector.rankHandler.updateScore\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game0\"\n            });\n        }\n    },\n\n    userInfoReq: function(userId) {\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                            \"account\": userId + \"\",\n                        });\n                    }, 200);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                \"account\": userId + \"\",\n            });\n        }\n    },\n\n    onDestroy() {\n        clientEvent.off(clientEvent.eventType.roundOver, this.roundOver, this);\n    }\n});\n"]}