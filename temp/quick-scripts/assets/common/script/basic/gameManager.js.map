{"version":3,"sources":["gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","on","eventType","roundOver","leaveRoomNotify","leaveRoom","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","wx","login","success","getUserInfo","fail","res","errMsg","indexOf","console","log","nickName","userInfo","avatarUrl","e","data","dispatch","leaveRoomMedNotify","gameState","GameState","Play","leaveRoomInfo","owner","id","isRoomOwner","friends","friendIds","filter","x","userId","length","friendCnt","gameOver","loseCamp","Camp","Friend","uiFunc","openUI","obj","uiVsResult","enemyIds","selfScore","enemyHearts","rivalScore","friendHearts","setData","bind","enemyCnt","Enemy","curRound","None","timeOver","Over","sendRoundStartMsg","startGame","readyCnt","loadScene","sendReadyMsg","sendRoundOverMsg","msg","action","ROUND_OVER","sendEventEx","ROUND_START","READY","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","networkStateNotify","result","engine","channel","platform","gameId","netNotify","kickPlayerRsp","status","rsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","removePersistRootNode","error","uiTip","logout","registerUser","deviceId","gatewayId","token","gameVersion","appKey","secret","info","lobbyShow","Canvas","instance","designResolution","height","width","cpProto","JSON","parse","GAME_START_EVENT","remoteUserIds","userIds","selfCamp","index","camp","push","playerUserIds","concat","player","PLAYER_FLY_EVENT","PlayerManager","getPlayerByUserId","srcUserId","flyNotify","PLAYER_FIRE_EVENT","i","j","playerId","fireNotify","bulletPointY","NEW_ITEM_EVENT","ItemManager","spawnItemNotify","PLAYER_GET_ITEM_EVENT","getItemNotify","PLAYER_REMOVE_ITEM_EVENT","removeItemNotify","PLAYER_HURT_EVENT","hurtNotify","murderId","getLoseCamp","loseCamp1","roundStart","TIME_OVER","m","dead","stringify","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","send","userInfoReq","onDestroy","off"],"mappings":"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","file":"gameManager.js","sourceRoot":"../../../../../../assets/common/script/basic","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    blockInput() {\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\n        setTimeout(function() {\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\n        }, 1000);\n    },\n    onLoad() {\n        Game.GameManager = this;\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getCollisionManager().enabled = true;\n        clientEvent.init();\n        dataFunc.loadConfigs();\n        cc.view.enableAutoFullScreen(false);\n        clientEvent.on(clientEvent.eventType.roundOver, this.roundOver, this);\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        this.network = window.network;\n        network.chooseNetworkMode();\n        this.getRankDataListener();\n        this.findPlayerByAccountListener();\n        try {\n            wx.login({\n                success: function() {\n                    wx.getUserInfo({\n                        fail: function(res) {\n                            // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n                            if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n                                // 处理用户拒绝授权的情况\n                                console.log(\"fail\");\n                            }\n                        },\n                        success: function(res) {\n                            Game.GameManager.nickName = res.userInfo.nickName;\n                            Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\n                            console.log('success', Game.GameManager.nickName);\n                        }\n                    });\n                }\n            })\n        } catch (e) {\n            \n        }\n    },\n\n    leaveRoom: function(data) {\n        // 离开房间--\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, data);\n        console.log(\"离开房间\");\n        if (this.gameState === GameState.Play) {\n            if (data.leaveRoomInfo.owner === GLB.userInfo.id) {\n                GLB.isRoomOwner = true;\n            }\n            var friends = this.friendIds.filter(function(x) {\n                return x === data.leaveRoomInfo.userId;\n            });\n\n            if (friends.length > 0) {\n                this.friendCnt--;\n                if (this.friendCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Friend});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            } else {\n                this.enemyCnt--;\n                if (this.enemyCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Enemy});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            }\n        }\n    },\n\n    roundOver: function(data) {\n        this.curRound++;\n        switch (data.loseCamp) {\n            case Camp.Friend:\n                this.friendHearts -= 1;\n                break;\n            case Camp.Enemy:\n                this.enemyHearts -= 1;\n                break;\n            case Camp.None:\n                this.enemyHearts -= 1;\n                this.friendHearts -= 1;\n                break;\n        }\n\n        if (this.enemyHearts > 0 && this.friendHearts > 0 && data.loseCamp === Camp.None) {\n            clientEvent.dispatch(clientEvent.eventType.timeOver);\n        }\n\n        if (this.enemyHearts <= 0 || this.friendHearts <= 0) {\n            // 结算界面--\n            this.gameState = GameState.Over;\n            var loseCamp = Camp.None;\n            if (this.enemyHearts <= 0 && this.friendHearts <= 0) {\n                loseCamp = Camp.None;\n            } else if (this.enemyHearts <= 0) {\n                loseCamp = Camp.Enemy;\n            } else {\n                loseCamp = Camp.Friend;\n            }\n            clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: loseCamp});\n            setTimeout(function() {\n                uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                    var uiVsResult = obj.getComponent(\"uiVsResult\");\n                    data = {\n                        friendIds: this.friendIds,\n                        enemyIds: this.enemyIds,\n                        selfScore: 3 - this.enemyHearts,\n                        rivalScore: 3 - this.friendHearts\n                    }\n                    uiVsResult.setData(data);\n                }.bind(this))\n            }.bind(this), 1500);\n\n        } else if (GLB.isRoomOwner) {\n            // 下一回合--\n            setTimeout(function() {\n                this.sendRoundStartMsg();\n            }.bind(this), 3000);\n        }\n    },\n\n    startGame: function() {\n        this.friendHearts = 3;\n        this.enemyHearts = 3;\n        this.curRound = 1;\n        this.readyCnt = 0;\n        this.friendCnt = this.friendIds.length;\n        this.enemyCnt = this.enemyIds.length;\n\n        cc.director.loadScene('game', function() {\n            uiFunc.openUI(\"uiGamePanel\", function() {\n                this.sendReadyMsg();\n            }.bind(this));\n        }.bind(this));\n    },\n\n    sendRoundOverMsg: function(loseCamp) {\n        var msg = {action: GLB.ROUND_OVER, loseCamp: loseCamp};\n        this.sendEventEx(msg);\n    },\n\n    sendRoundStartMsg: function() {\n        var msg = {action: GLB.ROUND_START};\n        this.sendEventEx(msg);\n    },\n\n    sendReadyMsg: function() {\n        var msg = {action: GLB.READY};\n        this.sendEventEx(msg);\n    },\n\n    matchVsInit: function() {\n        mvs.response.initResponse = this.initResponse.bind(this);\n        mvs.response.errorResponse = this.errorResponse.bind(this);\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\n        mvs.response.networkStateNotify = this.networkStateNotify.bind(this);\n\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\n        if (result !== 0) {\n            console.log('初始化失败,错误码:' + result);\n        }\n        Game.GameManager.blockInput();\n\n    },\n\n    networkStateNotify: function(netNotify) {\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, netNotify);\n    },\n\n    kickPlayerNotify: function(kickPlayerNotify) {\n        var data = {\n            kickPlayerNotify: kickPlayerNotify\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\n    },\n\n    kickPlayerResponse: function(kickPlayerRsp) {\n        if (kickPlayerRsp.status !== 200) {\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\n            return;\n        }\n        var data = {\n            kickPlayerRsp: kickPlayerRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\n    },\n\n    getRoomListExResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\n    },\n\n    getRoomDetailResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\n    },\n\n    getRoomListResponse: function(status, roomInfos) {\n        if (status !== 200) {\n            console.log(\"失败 status:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomInfos: roomInfos\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\n    },\n\n    createRoomResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 createRoomResponse:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\n    },\n\n    joinOverResponse: function(joinOverRsp) {\n        if (joinOverRsp.status !== 200) {\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\n            return;\n        }\n        var data = {\n            joinOverRsp: joinOverRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\n    },\n\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\n        if (status !== 200) {\n            console.log(\"失败 joinRoomResponse:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomUserInfoList: roomUserInfoList,\n            roomInfo: roomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\n    },\n\n    joinRoomNotify: function(roomUserInfo) {\n        var data = {\n            roomUserInfo: roomUserInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\n    },\n\n    leaveRoomResponse: function(leaveRoomRsp) {\n        if (leaveRoomRsp.status !== 200) {\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\n            return;\n        }\n        var data = {\n            leaveRoomRsp: leaveRoomRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\n    },\n\n    leaveRoomNotify: function(leaveRoomInfo) {\n        var data = {\n            leaveRoomInfo: leaveRoomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\n    },\n\n    logoutResponse: function(status) {\n        cc.game.removePersistRootNode(this.node);\n        cc.director.loadScene('lobby');\n    },\n\n    errorResponse: function(error, msg) {\n        if (error === 1001) {\n            uiFunc.openUI(\"uiTip\", function(obj) {\n                var uiTip = obj.getComponent(\"uiTip\");\n                if (uiTip) {\n                    uiTip.setData(\"网络断开连接\");\n                }\n            });\n            setTimeout(function() {\n                mvs.engine.logout(\"\");\n                cc.game.removePersistRootNode(this.node);\n                cc.director.loadScene('lobby');\n            }.bind(this), 2500);\n        }\n        console.log(\"错误信息：\" + error);\n        console.log(\"错误信息：\" + msg);\n    },\n\n    initResponse: function() {\n        console.log('初始化成功，开始注册用户');\n        var result = mvs.engine.registerUser();\n        if (result !== 0) {\n            console.log('注册用户失败，错误码:' + result);\n        } else {\n            console.log('注册用户成功');\n        }\n    },\n\n    registerUserResponse: function(userInfo) {\n        var deviceId = 'abcdef';\n        var gatewayId = 0;\n        GLB.userInfo = userInfo;\n\n        console.log('开始登录,用户Id:' + userInfo.id)\n\n        var result = mvs.engine.login(\n            userInfo.id, userInfo.token,\n            GLB.gameId, GLB.gameVersion,\n            GLB.appKey, GLB.secret,\n            deviceId, gatewayId\n        );\n        if (result !== 0) {\n            console.log('登录失败,错误码:' + result);\n        }\n    },\n\n    loginResponse: function(info) {\n        if (info.status !== 200) {\n            console.log('登录失败,异步回调错误码:' + info.status);\n        } else {\n            console.log('登录成功');\n            this.lobbyShow();\n        }\n    },\n\n    lobbyShow: function() {\n        this.gameState = GameState.None;\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiLobbyPanelVer\");\n        } else {\n            uiFunc.openUI(\"uiLobbyPanel\");\n        }\n    },\n\n    // 玩家行为通知--\n    sendEventNotify: function(info) {\n        var cpProto = JSON.parse(info.cpProto);\n\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\n            // 分队--\n            if (remoteUserIds.length % 2 !== 0) {\n                return console.log(\"人数不为偶数, 无法开战！\");\n            }\n            var selfCamp = 0;\n            var index;\n            for (index = 0; index < remoteUserIds.length; index++) {\n                if (GLB.userInfo.id === remoteUserIds[index]) {\n                    if (index < remoteUserIds.length / 2) {\n                        selfCamp = 0;\n                    } else {\n                        selfCamp = 1;\n                    }\n                    break;\n                }\n            }\n            this.enemyIds = [];\n            this.friendIds = [GLB.userInfo.id];\n            for (index = 0; index < remoteUserIds.length; index++) {\n                var camp = 0;\n                if (index < remoteUserIds.length / 2) {\n                    camp = 0;\n                } else {\n                    camp = 1;\n                }\n                if (camp === selfCamp) {\n                    if (remoteUserIds[index] !== GLB.userInfo.id) {\n                        this.friendIds.push(remoteUserIds[index]);\n                    }\n                } else {\n                    this.enemyIds.push(remoteUserIds[index]);\n                }\n            }\n            GLB.playerUserIds = this.friendIds.concat(this.enemyIds);\n            console.log(\"remoteUserIds:\" + remoteUserIds);\n            console.log(\"GLB.playerUserIds:\" + GLB.playerUserIds);\n\n            this.startGame();\n        }\n\n        var player = null;\n        if (info.cpProto.indexOf(GLB.PLAYER_FLY_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.flyNotify();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_FIRE_EVENT) >= 0) {\n            for (var i = 0; i < GLB.playerUserIds.length; i++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[i]);\n                if (player) {\n                    for (var j = 0; j < cpProto.data.length; j++) {\n                        if (cpProto.data[j].playerId === player.userId) {\n                            player.fireNotify(cpProto.data[j].bulletPointY);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.NEW_ITEM_EVENT) >= 0) {\n            Game.ItemManager.spawnItemNotify(cpProto);\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_GET_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n            if (player) {\n                player.getItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_REMOVE_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.removeItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_HURT_EVENT) >= 0) {\n            if (Game.GameManager.gameState !== GameState.Over) {\n                player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n                if (player) {\n                    player.hurtNotify(cpProto.murderId);\n                }\n                // 检查回合结束--\n                var loseCamp = Game.PlayerManager.getLoseCamp();\n                if (loseCamp != null) {\n                    Game.GameManager.gameState = GameState.Over\n                    if (GLB.isRoomOwner) {\n                        this.sendRoundOverMsg(loseCamp);\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            // 如果发送方为敌方--\n            var loseCamp1 = cpProto.loseCamp;\n            if (this.friendIds.indexOf(info.srcUserId) < 0) {\n                if (loseCamp1 === Camp.Friend) {\n                    loseCamp1 = Camp.Enemy;\n                } else if (loseCamp1 === Camp.Enemy) {\n                    loseCamp1 = Camp.Friend;\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: loseCamp1});\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\n            Game.GameManager.gameState = GameState.Play;\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\n        }\n\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\n            this.readyCnt++;\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\n                this.sendRoundStartMsg();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.TIME_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            for (var m = 0; m < GLB.playerUserIds.length; m++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[m]);\n                if (player) {\n                    player.dead();\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: Camp.None});\n        }\n    },\n\n    sendEventEx: function(msg) {\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    },\n\n    getRankDataListener: function() {\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\n                uiRankPanel.setData(recvMsg.rankArray);\n            });\n        }.bind(this));\n    },\n\n    findPlayerByAccountListener: function() {\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\n        });\n    },\n\n    loginServer: function() {\n        if (!this.network.isConnected()) {\n            this.network.connect(GLB.IP, GLB.PORT, function() {\n                    this.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        this.network.send(\"connector.rankHandler.updateScore\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game0\"\n                        });\n                    }.bind(this), 500);\n\n                }.bind(this)\n            );\n        } else {\n            this.network.send(\"connector.rankHandler.updateScore\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game0\"\n            });\n        }\n    },\n\n    userInfoReq: function(userId) {\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                            \"account\": userId + \"\",\n                        });\n                    }, 200);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                \"account\": userId + \"\",\n            });\n        }\n    },\n\n    onDestroy() {\n        clientEvent.off(clientEvent.eventType.roundOver, this.roundOver, this);\n    }\n});\n"]}